/** Notice * This file contains works from many authors under various (but compatible) licenses. Please see core.txt for more information. **/
(function(){(window.wpCoreControlsBundle=window.wpCoreControlsBundle||[]).push([[22],{336:function(Ea,va,ba){ba.r(va);var oa=ba(2),ka=ba(13),ja=ba(1);Ea=ba(43);var ea=ba(32),ca=ba(10);ba=function(){function y(){this.init()}y.prototype.init=function(){this.RU=!1;this.bf=this.Ai=this.connection=null;this.Vn={};this.Da=this.By=null};y.prototype.X6=function(r){for(var n=this,b=0;b<r.length;++b){var f=r[b];switch(f.at){case "create":this.Vn[f.author]||(this.Vn[f.author]=f.aName);this.n_(f);break;case "modify":this.Da.Oo(f.xfdf).then(function(e){n.Da.bN(e[0])});
break;case "delete":this.Da.Oo("<delete><id>"+f.aId+"</id></delete>")}}};y.prototype.n_=function(r){var n=this;this.Da.Oo(r.xfdf).then(function(b){b=b[0];b.authorId=r.author;n.Da.bN(b);n.Da.trigger(ka.a.UPDATE_ANNOTATION_PERMISSION,[b])})};y.prototype.RZ=function(r,n,b){this.Ai&&this.Ai(r,n,b)};y.prototype.preloadAnnotations=function(r){this.addEventListener("webViewerServerAnnotationsEnabled",this.RZ.bind(this,r,"add",{imported:!1}),{once:!0})};y.prototype.initiateCollaboration=function(r,n,b){var f=
this;if(r){f.bf=n;f.Da=b.Fa();b.addEventListener(ka.c.DOCUMENT_UNLOADED,function(){f.disableCollaboration()});f.s7(r);var e=new XMLHttpRequest;e.addEventListener("load",function(){if(200===e.status&&0<e.responseText.length)try{var h=JSON.parse(e.responseText);f.connection=exports.$a.Y7(Object(ea.g)(f.bf,"blackbox/"),"annot");f.By=h.id;f.Vn[h.id]=h.user_name;f.Da.ZN(h.id);f.connection.CE(function(z){z.t&&z.t.startsWith("a_")&&z.data&&f.X6(z.data)},function(){f.connection.send({t:"a_retrieve",dId:r});
f.trigger(y.Events.WEBVIEWER_SERVER_ANNOTATIONS_ENABLED,[f.Vn[h.id],f.By])},function(){f.disableCollaboration()})}catch(z){Object(ja.f)(z.message)}});e.open("GET",Object(ea.g)(this.bf,"demo/SessionInfo.jsp"));e.withCredentials=!0;e.send();f.RU=!0;f.Da.J4(function(h){return f.Vn[h.Author]||h.Author})}else Object(ja.f)("Document ID required for collaboration")};y.prototype.disableCollaboration=function(){this.Ai&&(this.Da.removeEventListener(ca.a.Events.ANNOTATION_CHANGED,this.Ai),this.Ai=null);this.connection&&
this.connection.hB();this.Da&&this.Da.ZN("Guest");this.init();this.trigger(y.Events.WEBVIEWER_SERVER_ANNOTATIONS_DISABLED)};y.prototype.s7=function(r){var n=this;this.Ai&&this.Da.removeEventListener(ca.a.Events.ANNOTATION_CHANGED,this.Ai);this.Ai=function(b,f,e){return Object(oa.b)(this,void 0,void 0,function(){var h,z,x,a,w,aa,ia,fa,ha;return Object(oa.d)(this,function(da){switch(da.label){case 0:if(e.imported)return[2];h={t:"a_"+f,dId:r,annots:[]};return[4,n.Da.qX()];case 1:z=da.ja();"delete"!==
f&&(x=(new DOMParser).parseFromString(z,"text/xml"),a=new XMLSerializer);for(w=0;w<b.length;w++)aa=b[w],fa=ia=void 0,"add"===f?(ia=x.querySelector('[name="'+aa.Id+'"]'),fa=a.serializeToString(ia),ha=null,aa.InReplyTo&&(ha=n.Da.wJ(aa.InReplyTo).authorId||"default"),h.annots.push({at:"create",aId:aa.Id,author:n.By,aName:n.Vn[n.By],parent:ha,xfdf:"<add>"+fa+"</add>"})):"modify"===f?(ia=x.querySelector('[name="'+aa.Id+'"]'),fa=a.serializeToString(ia),h.annots.push({at:"modify",aId:aa.Id,xfdf:"<modify>"+
fa+"</modify>"})):"delete"===f&&h.annots.push({at:"delete",aId:aa.Id});0<h.annots.length&&n.connection.send(h);return[2]}})})}.bind(n);this.Da.addEventListener(ca.a.Events.ANNOTATION_CHANGED,this.Ai)};y.Events={WEBVIEWER_SERVER_ANNOTATIONS_ENABLED:"webViewerServerAnnotationsEnabled",WEBVIEWER_SERVER_ANNOTATIONS_DISABLED:"webViewerServerAnnotationsDisabled"};return y}();Object(Ea.a)(ba);va["default"]=ba}}]);}).call(this || window)
